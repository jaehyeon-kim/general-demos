version: 2

models:
  - name: dim_products
    description: Products table, which is converted into SCD Type 2
    columns:
      - name: product_key
        description: |
          Primary key of the table
          Surrogate key, which is generated by md5 hash using the following columns
            - name, description, price, category, image
        tests:
          - not_null
          - unique
      - name: product_id
        description: Natural key of products
      - name: name
        description: Porduct name
      - name: description
        description: Product description
      - name: price
        description: Product price
      - name: category
        description: Product category
      - name: image
        description: Product image
      - name: created_at
        description: Timestamp when the record is loaded
      - name: valid_from
        description: Effective start timestamp of the corresponding record (inclusive)
      - name: valid_to
        description: Effective end timestamp of the corresponding record (exclusive)
  - name: dim_users
    description: Users table, which is converted into SCD Type 2
    columns:
      - name: user_key
        description: |
          Primary key of the table
          Surrogate key, which is generated by md5 hash using the following columns
            - first_name, last_name, email, residence, lat, lon
        tests:
          - not_null
          - unique
      - name: user_id
        description: Natural key of users
      - name: first_name
        description: First name
      - name: last_name
        description: Last name
      - name: email
        description: Email address
      - name: residence
        description: User address
      - name: latitude
        description: Latitude of user address
      - name: longitude
        description: Longitude of user address
      - name: created_at
        description: Timestamp when the record is loaded
      - name: valid_from
        description: Effective start timestamp of the corresponding record (inclusive)
      - name: valid_to
        description: Effective end timestamp of the corresponding record (exclusive)
  - name: fct_orders
    description: Orders fact table. Order items are exploded into rows
    columns:
      - name: order_id
        description: Natural key of orders
      - name: product
        description: |
          Array of products in an order.
          A product is an array of struct where the following attributes are pre-joined from the dim_products table:
            key (product_key), id (product_id), name, price, quantity, description, category, and image
      - name: user
        description: |
          A struct where the following attributes are pre-joined from the dim_users table:
            key (user_key), id (user_id), first_name, last_name, email, residence, latitude, and longitude
      - name: created_at
        description: Timestamp when the record is loaded
