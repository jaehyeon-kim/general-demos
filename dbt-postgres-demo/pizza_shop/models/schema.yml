version: 2

models:
  - name: dim_products
    description: Products table, which is converted into SCD Type 2
    columns:
      - name: product_key
        description: |
          Primary key of the table
          Surrogate key, which is generated by md5 hash using the following columns
            - name, description, price, category, image
        tests:
          - not_null
          - unique
      - name: product_id
        description: Natural key of products
      - name: name
        description: Porduct name
      - name: description
        description: Product description
      - name: price
        description: Product price
      - name: category
        description: Product category
      - name: image
        description: Product image
      - name: created_at
        description: Timestamp when the record is loaded
      - name: valid_from
        description: Effective start timestamp of the corresponding record (inclusive)
      - name: valid_to
        description: Effective end timestamp of the corresponding record (exclusive)
  - name: dim_users
    description: Users table, which is converted into SCD Type 2
    columns:
      - name: user_key
        description: |
          Primary key of the table
          Surrogate key, which is generated by md5 hash using the following columns
            - first_name, last_name, email, residence, lat, lon
        tests:
          - not_null
          - unique
      - name: user_id
        description: Natural key of users
      - name: first_name
        description: First name
      - name: last_name
        description: Last name
      - name: email
        description: Email address
      - name: residence
        description: User address
      - name: latitude
        description: Latitude of user address
      - name: longitude
        description: Longitude of user address
      - name: created_at
        description: Timestamp when the record is loaded
      - name: valid_from
        description: Effective start timestamp of the corresponding record (inclusive)
      - name: valid_to
        description: Effective end timestamp of the corresponding record (exclusive)
  - name: fct_orders
    description: Orders fact table. Order items are exploded into rows
    columns:
      - name: order_key
        description: |
          Primary key of the table
          Surrogate key, which is generated by md5 hash using the following columns
            - order_id, product_id, user_id
        tests:
          - not_null
          - unique
      - name: product_key
        description: Product surrogate key which matches the product dimension record
        tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: product_key
      - name: user_key
        description: User surrogate key which matches the user dimension record
        tests:
          - not_null
          - relationships:
              to: ref('dim_users')
              field: user_key
      - name: order_id
        description: Natural key of orders
      - name: user_id
        description: Natural key of users
      - name: product_id
        description: Natural key of products
      - name: quantity
        description: Amount of products ordered
      - name: created_at
        description: Timestamp when the record is loaded
